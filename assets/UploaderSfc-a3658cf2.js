import{a as Ve,H as Re,u as Pe}from"./index-fe11295e.js";import{F as Ce,u as ke}from"./provide-982d6f56.js";import{I as Be}from"./index-59b46fed.js";import{P as Se}from"./popup-ba9fd071.js";import{I as q}from"./imagePreview-d0017566.js";import{v as De}from"./index-c5f09b40.js";import{d as Fe,a as A,b as Q,w as $e,p as F,ag as J,f as V,h as R,M as $,F as Le,ai as Te,D as K,N as d,Q as Ue,ah as He,q as S,j as L,R as Ae,O as Ne,S as ze,n as Me,r as D}from"./vue-router.esm-bundler-fa266481.js";import{a as C,A as Ie,n as Oe,e as g,_ as X,$ as Y,c as Ee,h as Z,k as _,g as x}from"./shared-128c81f0.js";var We={modelValue:{type:Array,default:()=>[]},accept:{type:String,default:"image/*"},capture:{type:[String,Boolean],default:void 0},multiple:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},removable:{type:Boolean,default:!0},maxlength:{type:[Number,String]},maxsize:{type:[Number,String]},previewed:{type:Boolean,default:!0},ripple:{type:Boolean,default:!0},validateTrigger:{type:Array,default:()=>["onChange","onRemove"]},rules:{type:Array},hideList:{type:Boolean,default:!1},onBeforeRead:C(),onAfterRead:C(),onBeforeRemove:C(),onRemove:C(),onOversize:C(),"onUpdate:modelValue":C()};function ee(e,s,v,u,h,l,m){try{var p=e[l](m),r=p.value}catch(y){v(y);return}p.done?s(r):Promise.resolve(r).then(u,h)}function ae(e){return function(){var s=this,v=arguments;return new Promise(function(u,h){var l=e.apply(s,v);function m(r){ee(l,u,h,m,p,"next",r)}function p(r){ee(l,u,h,m,p,"throw",r)}m(void 0)})}}var{n:Ge,classes:je}=Ee("uploader"),qe=0,Qe=["onClick"],Je=["onClick"],Ke=["src","alt"],Xe=["multiple","accept","capture","disabled"],Ye=["src"];function Ze(e,s){var v=F("var-icon"),u=F("var-hover-overlay"),h=F("var-form-details"),l=F("var-popup"),m=J("ripple"),p=J("hover");return V(),R("div",{class:d(e.classes(e.n(),e.n("$--box")))},[$("div",{class:d(e.n("file-list"))},[(V(!0),R(Le,null,Te(e.files,r=>K((V(),R("div",{class:d(e.classes(e.n("file"),e.n("$-elevation--2"),[r.state==="loading",e.n("--loading")])),key:r.id,onClick:y=>e.preview(r)},[$("div",{class:d(e.n("file-name"))},Ue(r.name||r.url),3),e.removable?(V(),R("div",{key:0,class:d(e.n("file-close")),onClick:He(y=>e.handleRemove(r),["stop"])},[S(v,{class:d(e.n("file-close-icon")),"var-uploader-cover":"",name:"delete"},null,8,["class"])],10,Je)):L("v-if",!0),r.cover?(V(),R("img",{key:1,class:d(e.n("file-cover")),style:Ae({objectFit:r.fit}),src:r.cover,alt:r.name},null,14,Ke)):L("v-if",!0),$("div",{class:d(e.classes(e.n("file-indicator"),[r.state==="success",e.n("--success")],[r.state==="error",e.n("--error")]))},null,2)],10,Qe)),[[m,{disabled:e.disabled||e.formDisabled||e.readonly||e.formReadonly||!e.ripple}]])),128)),!e.maxlength||e.modelValue.length<e.maxlength?K((V(),R("div",{key:0,class:d(e.classes([!e.$slots.default,e.n("action")+" "+e.n("$-elevation--2")],[e.disabled||e.formDisabled,e.n("--disabled")])),onClick:s[1]||(s[1]=function(){return e.chooseFile&&e.chooseFile(...arguments)})},[$("input",{ref:"input",type:"file",class:d(e.n("action-input")),multiple:e.multiple,accept:e.accept,capture:e.capture,disabled:e.disabled||e.formDisabled||e.readonly||e.formReadonly,onChange:s[0]||(s[0]=function(){return e.handleChange&&e.handleChange(...arguments)})},null,42,Xe),Ne(e.$slots,"default",{},()=>[S(v,{class:d(e.n("action-icon")),"var-uploader-cover":"",name:"plus"},null,8,["class"]),S(u,{hovering:e.hovering&&!e.disabled&&!e.formDisabled},null,8,["hovering"])])],2)),[[m,{disabled:e.disabled||e.formDisabled||e.readonly||e.formReadonly||!e.ripple||e.$slots.default}],[p,e.handleHovering,"desktop"]]):L("v-if",!0)],2),S(h,{"error-message":e.errorMessage,"extra-message":e.maxlengthText},null,8,["error-message","extra-message"]),S(l,{class:d(e.n("preview")),"var-uploader-cover":"",position:"center",show:e.showPreview,"onUpdate:show":s[2]||(s[2]=r=>e.showPreview=r),onClosed:s[3]||(s[3]=r=>e.currentPreview=null)},{default:ze(()=>{var r,y;return[e.currentPreview&&e.isHTMLSupportVideo((r=e.currentPreview)==null?void 0:r.url)?(V(),R("video",{key:0,class:d(e.n("preview-video")),playsinline:"true","webkit-playsinline":"true","x5-playsinline":"true","x5-video-player-type":"h5","x5-video-player-fullscreen":"false",controls:"",src:(y=e.currentPreview)==null?void 0:y.url},null,10,Ye)):L("v-if",!0)]}),_:1},8,["class","show"])],2)}var re=Fe({name:"VarUploader",directives:{Ripple:De,Hover:Ve},components:{VarIcon:Be,VarPopup:Se,VarFormDetails:Ce,VarHoverOverlay:Re},props:We,setup(e){var s=A(null),v=A(!1),u=A(null),h=Q(()=>{var{maxlength:a,modelValue:{length:n}}=e;return Ie(a)?n+" / "+a:""}),{form:l,bindForm:m}=ke(),{errorMessage:p,validateWithTrigger:r,validate:y,resetValidation:T}=Oe(),{hovering:le,handleHovering:ne}=Pe(),oe=Q(()=>{var{modelValue:a,hideList:n}=e;return n?[]:a}),ie=a=>{var{disabled:n,readonly:o,previewed:t}=e;if(!(l!=null&&l.disabled.value||l!=null&&l.readonly.value||n||o||!t)){var{url:i}=a;if(Z(i)&&Y(i)){q(i);return}Z(i)&&X(i)&&(u.value=a,v.value=!0)}},se=a=>({id:qe++,url:"",cover:"",name:a.name,file:a}),te=a=>{var n=a.target,{files:o}=n;return Array.from(o)},de=a=>new Promise(n=>{var o=new FileReader;o.onload=()=>{var t=o.result;a.file.type.startsWith("image")&&(a.cover=t),a.url=t,n(a)},o.readAsDataURL(a.file)}),ve=a=>a.map(de),ue=a=>{var{onBeforeRead:n}=e;return a.map(o=>new Promise(t=>{n||t({valid:!0,varFile:o});var i=g(n,D(o));i=x(i)?i:[i],Promise.all(i).then(P=>{t({valid:!P.some(k=>!k),varFile:o})})}))},me=function(){var a=ae(function*(n){var{maxsize:o,maxlength:t,modelValue:i,onOversize:P,onAfterRead:k,readonly:b,disabled:H}=e;if(!(l!=null&&l.disabled.value||l!=null&&l.readonly.value||H||b)){var B=f=>f.filter(c=>c.file.size>_(o)?(g(P,D(c)),!1):!0),ye=f=>{var c=Math.min(f.length,_(t)-i.length);return f.slice(0,c)},ce=te(n),w=ce.map(se);w=o!=null?B(w):w,w=t!=null?ye(w):w;var be=yield Promise.all(ve(w)),we=yield Promise.all(ue(be)),j=we.filter(f=>{var{valid:c}=f;return c}).map(f=>{var{varFile:c}=f;return c});g(e["onUpdate:modelValue"],[...i,...j]),n.target.value="",j.forEach(f=>g(k,D(f)))}});return function(o){return a.apply(this,arguments)}}(),fe=function(){var a=ae(function*(n){var{disabled:o,readonly:t,modelValue:i,onBeforeRemove:P,onRemove:k}=e;if(!(l!=null&&l.disabled.value||l!=null&&l.readonly.value||o||t)){if(P){var b=g(P,D(n));if(b=x(b)?b:[b],(yield Promise.all(b)).some(B=>!B))return}var H=i.filter(B=>B!==n);g(k,D(n)),E("onRemove"),g(e["onUpdate:modelValue"],H)}});return function(o){return a.apply(this,arguments)}}(),z=()=>e.modelValue.filter(a=>a.state==="success"),M=()=>e.modelValue.filter(a=>a.state==="error"),I=()=>e.modelValue.filter(a=>a.state==="loading"),pe=()=>{s.value.click()},ge=()=>{u.value=null,v.value=!1,q.close()},O={getSuccess:z,getError:M,getLoading:I},E=a=>{Me(()=>{var{validateTrigger:n,rules:o,modelValue:t}=e;r(n,a,o,t,O)})},U=!1,W=()=>y(e.rules,e.modelValue,O),G=()=>{U=!0,g(e["onUpdate:modelValue"],[]),T()},he={validate:W,resetValidation:T,reset:G};return g(m,he),$e(()=>e.modelValue,()=>{!U&&E("onChange"),U=!1},{deep:!0}),{n:Ge,classes:je,input:s,files:oe,showPreview:v,currentPreview:u,errorMessage:p,maxlengthText:h,hovering:le,formDisabled:l==null?void 0:l.disabled,formReadonly:l==null?void 0:l.readonly,handleHovering:ne,isHTMLSupportVideo:X,isHTMLSupportImage:Y,preview:ie,handleChange:me,handleRemove:fe,getSuccess:z,getError:M,getLoading:I,validate:W,resetValidation:T,reset:G,chooseFile:pe,closePreview:ge}}});re.render=Ze;const N=re;N.install=function(e){e.component(N.name,N)};export{N as U};
