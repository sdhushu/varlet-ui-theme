import{p as te,S as ie,a as se}from"./index-29656355.js";import{I as le}from"./index-59b46fed.js";import{p as ue,P as ve}from"./popup-ba9fd071.js";import{p as E,a as pe,c as me,e as k,k as F,i as ce,m as de,h as he,g as fe}from"./shared-128c81f0.js";import{d as ge,a as d,b as we,w as Te,p as P,f as S,i as R,S as D,q as Ce,h as L,ai as Oe,N as h,M as Y,R as ye,F as Se,O as z,Q as U,j as q,m as Ie,r as be,n as Pe}from"./vue-router.esm-bundler-fa266481.js";function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},V.apply(this,arguments)}var De=V({show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":pe()},E(te,["loop","indicator","onChange"]),E(ue,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])),{n:H,classes:ke}=me("image-preview"),W=12,Q=200,Ne=350,Z=200,Re=["src","alt"];function Ye(e,t){var o=P("var-swipe-item"),i=P("var-swipe"),p=P("var-icon"),g=P("var-popup");return S(),R(g,{class:h(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:D(()=>[Ce(i,Ie({class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:D(()=>[(S(!0),L(Se,null,Oe(e.images,v=>(S(),R(o,{class:h(e.n("swipe-item")),"var-image-preview-cover":"",key:v},{default:D(()=>[Y("div",{class:h(e.n("zoom-container")),style:ye({transform:"scale("+e.scale+") translate("+e.translateX+"px, "+e.translateY+"px)",transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:t[0]||(t[0]=function(){return e.handleTouchstart&&e.handleTouchstart(...arguments)}),onTouchmove:t[1]||(t[1]=function(){return e.handleTouchmove&&e.handleTouchmove(...arguments)}),onTouchend:t[2]||(t[2]=function(){return e.handleTouchend&&e.handleTouchend(...arguments)})},[Y("img",{class:h(e.n("image")),src:v,alt:v},null,10,Re)],38)]),_:2},1032,["class"]))),128))]),indicator:D(v=>{var{index:w,length:T}=v;return[z(e.$slots,"indicator",{index:w,length:T},()=>[e.indicator&&e.images.length>1?(S(),L("div",{key:0,class:h(e.n("indicators"))},U(w+1)+" / "+U(T),3)):q("v-if",!0)])]}),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),z(e.$slots,"close-icon",{},()=>[e.closeable?(S(),R(p,{key:0,class:h(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):q("v-if",!0)]),Y("div",{class:h(e.n("extra"))},[z(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}var G=ge({name:"VarImagePreview",components:{VarSwipe:ie,VarSwipeItem:se,VarPopup:ve,VarIcon:le},inheritAttrs:!1,props:De,setup(e){var t=d(!1),o=we(()=>{var{images:a,current:r}=e,n=a.findIndex(l=>l===r);return n>=0?n:0}),i=d(1),p=d(0),g=d(0),v=d(void 0),w=d(void 0),T=d(!0),C=null,s=null,N=null,X=(a,r)=>{var{clientX:n,clientY:l}=a,{clientX:u,clientY:m}=r;return Math.abs(Math.sqrt(Math.pow(u-n,2)+Math.pow(m-l,2)))},A=(a,r)=>({clientX:a.clientX,clientY:a.clientY,timestamp:Date.now(),target:r}),J=()=>{i.value=F(e.zoom),T.value=!1,s=null,window.setTimeout(()=>{v.value="linear",w.value="0s"},Z)},M=()=>{i.value=1,p.value=0,g.value=0,T.value=!0,s=null,v.value=void 0,w.value=void 0},K=a=>s?X(s,a)<=W&&a.timestamp-s.timestamp<=Q&&s.target===a.target:!1,_=a=>!a||!C||!s?!1:X(C,s)<=W&&Date.now()-s.timestamp<Ne&&(a===C.target||a.parentNode===C.target),x=a=>{N=window.setTimeout(()=>{_(a.target)&&B(),C=null},Q)},ee=a=>{N&&window.clearTimeout(N);var{touches:r}=a,n=A(r[0],a.currentTarget);if(C=n,K(n)){i.value>1?M():J();return}s=n},$=a=>{var{offsetWidth:r,offsetHeight:n}=a,{naturalWidth:l,naturalHeight:u}=a.querySelector("."+H("image"));return{width:r,height:n,imageRadio:u/l,rootRadio:n/r,zoom:F(e.zoom)}},ae=a=>{var{zoom:r,imageRadio:n,rootRadio:l,width:u,height:m}=$(a);if(!n)return 0;var y=n>l?m/n:u;return Math.max(0,(r*y-u)/2)/r},ne=a=>{var{zoom:r,imageRadio:n,rootRadio:l,width:u,height:m}=$(a);if(!n)return 0;var y=n>l?m:u*n;return Math.max(0,(r*y-m)/2)/r},j=(a,r,n)=>a+r>=n?n:a+r<=-n?-n:a+r,re=a=>{if(s){var r=a.currentTarget,{touches:n}=a,l=A(n[0],r);if(i.value>1){var u=l.clientX-s.clientX,m=l.clientY-s.clientY,y=ae(r),oe=ne(r);p.value=j(p.value,u,y),g.value=j(g.value,m,oe)}s=l}},B=()=>{if(i.value>1){M(),setTimeout(()=>k(e["onUpdate:show"],!1),Z);return}k(e["onUpdate:show"],!1)};return Te(()=>e.show,a=>{t.value=a},{immediate:!0}),{n:H,classes:ke,initialIndex:o,popupShow:t,scale:i,translateX:p,translateY:g,canSwipe:T,transitionTimingFunction:v,transitionDuration:w,handleTouchstart:ee,handleTouchmove:re,handleTouchend:x,close:B}}});G.render=Ye;const f=G;function I(){return I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e},I.apply(this,arguments)}var c,b={};function ze(e){return e===void 0&&(e={}),he(e)?I({},b,{images:[e]}):fe(e)?I({},b,{images:e}):I({},b,e)}function O(e){if(ce()){O.close();var t=ze(e),o=be(t);o.teleport="body",c=o;var{unmountInstance:i}=de(f,o,{onClose:()=>k(o.onClose),onClosed:()=>{k(o.onClosed),i(),c===o&&(c=null)},onRouteChange:()=>{i(),c===o&&(c=null)},"onUpdate:show":p=>{o.show=p}});o.show=!0}}O.close=()=>{if(c!=null){var e=c;c=null,Pe().then(()=>{e.show=!1})}};O.setDefaultOptions=e=>{b=e};O.resetDefaultOptions=()=>{b={}};f.install=function(e){e.component(f.name,f)};O.install=function(e){e.component(f.name,f)};O.Component=f;export{O as I};
