import{p as ae,S as ne,a as oe}from"./index.76bcfda0.js";import{I as re}from"./index.7a42f2c5.js";import{p as te,P as ie}from"./popup.71b6288d.js";import{p as F,c as le,b as B,m as se}from"./shared.07bb7935.js";import{d as ue,a as d,b as ve,w as pe,p as I,f as S,i as N,S as O,q as me,h as E,ak as ce,N as h,M as P,R as de,F as he,O as R,Q as $,j as L,m as ge,Z as U,at as fe,r as we,n as Te,W as Ce,aA as ye}from"./vue-router.esm-bundler.25bd2824.js";function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Y.apply(this,arguments)}var Se=Y({show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},current:{type:String},zoom:{type:[String,Number],default:2},closeable:{type:Boolean,default:!1},"onUpdate:show":{type:Function}},F(ae,["loop","indicator","onChange"]),F(te,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])),{n:Ie,classes:Oe}=le("image-preview"),j=12,W=200,be=350,q=200,ke=["src","alt"];function Ne(e,t){var r=I("var-swipe-item"),i=I("var-swipe"),p=I("var-icon"),f=I("var-popup");return S(),N(f,{class:h(e.n("popup")),"var-image-preview-cover":"",transition:"var-fade",show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:O(()=>[me(i,ge({class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:O(()=>[(S(!0),E(he,null,ce(e.images,v=>(S(),N(r,{class:h(e.n("swipe-item")),"var-image-preview-cover":"",key:v},{default:O(()=>[P("div",{class:h(e.n("zoom-container")),style:de({transform:"scale("+e.scale+") translate("+e.translateX+"px, "+e.translateY+"px)",transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:t[0]||(t[0]=function(){return e.handleTouchstart&&e.handleTouchstart(...arguments)}),onTouchmove:t[1]||(t[1]=function(){return e.handleTouchmove&&e.handleTouchmove(...arguments)}),onTouchend:t[2]||(t[2]=function(){return e.handleTouchend&&e.handleTouchend(...arguments)})},[P("img",{class:h(e.n("image")),src:v,alt:v},null,10,ke)],38)]),_:2},1032,["class"]))),128))]),indicator:O(v=>{var{index:w,length:T}=v;return[R(e.$slots,"indicator",{index:w,length:T},()=>[e.indicator&&e.images.length>1?(S(),E("div",{key:0,class:h(e.n("indicators"))},$(w+1)+" / "+$(T),3)):L("v-if",!0)])]}),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),R(e.$slots,"close-icon",{},()=>[e.closeable?(S(),N(p,{key:0,class:h(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):L("v-if",!0)]),P("div",{class:h(e.n("extra"))},[R(e.$slots,"extra")],2)]),_:3},8,["class","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const g=ue({render:Ne,name:"VarImagePreview",components:{VarSwipe:ne,VarSwipeItem:oe,VarPopup:ie,VarIcon:re},inheritAttrs:!1,props:Se,setup(e){var t=d(!1),r=ve(()=>{var{images:a,current:o}=e,n=a.findIndex(s=>s===o);return n>=0?n:0}),i=d(1),p=d(0),f=d(0),v=d(void 0),w=d(void 0),T=d(!0),C=null,l=null,k=null,D=(a,o)=>{var{clientX:n,clientY:s}=a,{clientX:u,clientY:m}=o;return Math.abs(Math.sqrt(Math.pow(u-n,2)+Math.pow(m-s,2)))},z=(a,o)=>({clientX:a.clientX,clientY:a.clientY,timestamp:Date.now(),target:o}),H=()=>{i.value=U(e.zoom),T.value=!1,l=null,window.setTimeout(()=>{v.value="linear",w.value="0s"},q)},A=()=>{i.value=1,p.value=0,f.value=0,T.value=!0,l=null,v.value=void 0,w.value=void 0},Z=a=>l?D(l,a)<=j&&a.timestamp-l.timestamp<=W&&l.target===a.target:!1,Q=a=>!a||!C||!l?!1:D(C,l)<=j&&Date.now()-l.timestamp<be&&(a===C.target||a.parentNode===C.target),G=a=>{k=window.setTimeout(()=>{Q(a.target)&&M(),C=null},W)},J=a=>{k&&window.clearTimeout(k);var{touches:o}=a,n=z(o[0],a.currentTarget);if(C=n,Z(n)){i.value>1?A():H();return}l=n},V=a=>{var{offsetWidth:o,offsetHeight:n}=a,{naturalWidth:s,naturalHeight:u}=a.querySelector(".var-image-preview__image");return{width:o,height:n,imageRadio:u/s,rootRadio:n/o,zoom:U(e.zoom)}},K=a=>{var{zoom:o,imageRadio:n,rootRadio:s,width:u,height:m}=V(a);if(!n)return 0;var y=n>s?m/n:u;return Math.max(0,(o*y-u)/2)/o},_=a=>{var{zoom:o,imageRadio:n,rootRadio:s,width:u,height:m}=V(a);if(!n)return 0;var y=n>s?m:u*n;return Math.max(0,(o*y-m)/2)/o},X=(a,o,n)=>a+o>=n?n:a+o<=-n?-n:a+o,x=a=>{if(!!l){var o=a.currentTarget,{touches:n}=a,s=z(n[0],o);if(i.value>1){var u=s.clientX-l.clientX,m=s.clientY-l.clientY,y=K(o),ee=_(o);p.value=X(p.value,u,y),f.value=X(f.value,m,ee)}l=s}},M=()=>{if(i.value>1){A(),setTimeout(()=>B(e["onUpdate:show"],!1),q);return}B(e["onUpdate:show"],!1)};return pe(()=>e.show,a=>{t.value=a},{immediate:!0}),{n:Ie,classes:Oe,initialIndex:r,popupShow:t,scale:i,translateX:p,translateY:f,canSwipe:T,transitionTimingFunction:v,transitionDuration:w,handleTouchstart:J,handleTouchmove:x,handleTouchend:G,close:M}}});var c;function b(e){if(!!fe()){b.close();var t=Ce(e)?{images:[e]}:ye(e)?{images:e}:e,r=we(t);r.teleport="body",c=r;var{unmountInstance:i}=se(g,r,{onClose:()=>r.onClose==null?void 0:r.onClose(),onClosed:()=>{r.onClosed==null||r.onClosed(),i(),c===r&&(c=null)},onRouteChange:()=>{i(),c===r&&(c=null)},"onUpdate:show":p=>{r.show=p}});r.show=!0}}b.close=()=>{if(c!=null){var e=c;c=null,Te().then(()=>{e.show=!1})}};g.install=function(e){e.component(g.name,g)};b.install=function(e){e.component(g.name,g)};b.Component=g;export{b as I};
